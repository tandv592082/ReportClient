"use strict";(self["webpackChunkwork"]=self["webpackChunkwork"]||[]).push([[488],{9488:function(t,e,i){i.r(e),i.d(e,{default:function(){return m}});var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("v-snackbar",{attrs:{timeout:2e3,absolute:"",centered:"",top:"",color:t.success?"green":"red"},model:{value:t.snackbar,callback:function(e){t.snackbar=e},expression:"snackbar"}},[t._v(" "+t._s(t.msg)+" ")]),t.workData?i("v-card",[i("v-data-table",{staticClass:"elevation-1",attrs:{headers:t.headers,items:t.workData,"sort-by":"name"},scopedSlots:t._u([{key:"top",fn:function(){return[i("v-toolbar",{attrs:{flat:""}},[i("v-toolbar-title",[t._v("Danh sách bảng trực nhật đã tạo")]),i("v-divider",{staticClass:"mx-4",attrs:{inset:"",vertical:""}}),i("v-spacer"),i("v-dialog",{attrs:{"max-width":"500px"},scopedSlots:t._u([{key:"activator",fn:function(e){var a=e.on,s=e.attrs;return[i("v-btn",t._g(t._b({staticClass:"mb-2",attrs:{color:"primary",dark:""}},"v-btn",s,!1),a),[t._v(" Thêm bảng trực nhật ")])]}}]),model:{value:t.dialog,callback:function(e){t.dialog=e},expression:"dialog"}},[i("v-card",[i("v-card-title",[i("span",{staticClass:"text-h5"},[t._v(t._s(-1===t.editedIndex?"Thêm bảng trực nhật":"Sửa bảng trực nhật"))])]),i("v-card-text",[i("v-container",[i("v-form",{ref:"form",attrs:{"lazy-validation":""},model:{value:t.valid,callback:function(e){t.valid=e},expression:"valid"}},[i("v-row",[i("v-col",{attrs:{cols:"12",sm:"6",md:"12"}},[i("v-menu",{attrs:{"close-on-content-click":!1,"nudge-right":40,transition:"scale-transition","offset-y":"","min-width":"auto"},scopedSlots:t._u([{key:"activator",fn:function(e){var a=e.on,s=e.attrs;return[i("v-text-field",t._g(t._b({attrs:{label:"Ngày thực hiện",disabled:t.loading,readonly:"",rules:t.notEmptyDate},model:{value:t.editedItem.date,callback:function(e){t.$set(t.editedItem,"date",e)},expression:"editedItem.date"}},"v-text-field",s,!1),a))]}}]),model:{value:t.menu,callback:function(e){t.menu=e},expression:"menu"}},[i("v-date-picker",{on:{input:function(e){t.menu=!1}},model:{value:t.editedItem.date,callback:function(e){t.$set(t.editedItem,"date",e)},expression:"editedItem.date"}})],1)],1),i("v-col",{attrs:{cols:"12",sm:"6",md:"12"}},[i("v-select",{attrs:{items:t.userData,"item-text":"name","item-value":"id","menu-props":{maxHeight:"400"},label:"Chọn học sinh tham gia",multiple:"","persistent-hint":"",rules:t.notEmptyUsers},model:{value:t.editedItem.users,callback:function(e){t.$set(t.editedItem,"users",e)},expression:"editedItem.users"}})],1),i("v-col",{attrs:{cols:"12",sm:"12",md:"12"}},[i("v-textarea",{attrs:{type:"text",disabled:t.loading,label:"Ghi chú"},model:{value:t.editedItem.description,callback:function(e){t.$set(t.editedItem,"description",e)},expression:"editedItem.description"}})],1),i("v-col",{attrs:{cols:"12",sm:"12"}},[i("v-menu",{ref:"menu",attrs:{"close-on-content-click":!1,"nudge-right":40,"return-value":t.editedItem.expires,transition:"scale-transition","offset-y":"","max-width":"290px","min-width":"290px"},on:{"update:returnValue":function(e){return t.$set(t.editedItem,"expires",e)},"update:return-value":function(e){return t.$set(t.editedItem,"expires",e)}},scopedSlots:t._u([{key:"activator",fn:function(e){var a=e.on,s=e.attrs;return[i("v-text-field",t._g(t._b({attrs:{label:"Chọn giờ kết thúc",readonly:"",rles:t.notEmptyExpires},model:{value:t.editedItem.expires,callback:function(e){t.$set(t.editedItem,"expires",e)},expression:"editedItem.expires"}},"v-text-field",s,!1),a))]}}]),model:{value:t.menu2,callback:function(e){t.menu2=e},expression:"menu2"}},[t.menu2?i("v-time-picker",{attrs:{"full-width":""},on:{"click:minute":function(e){return t.$refs.menu.save(t.editedItem.expires)}},model:{value:t.editedItem.expires,callback:function(e){t.$set(t.editedItem,"expires",e)},expression:"editedItem.expires"}}):t._e()],1)],1)],1)],1)],1)],1),i("v-card-actions",[i("v-spacer"),i("v-btn",{attrs:{color:"blue darken-1",text:""},on:{click:t.close}},[t._v(" Đóng ")]),i("v-btn",{attrs:{disabled:!t.valid||t.loading,color:"blue"},on:{click:t.save}},[t._v(" Lưu ")])],1)],1)],1),i("v-dialog",{attrs:{"max-width":"500px"},model:{value:t.dialogDelete,callback:function(e){t.dialogDelete=e},expression:"dialogDelete"}},[i("v-card",[i("v-card-title",{staticClass:"text-h5"},[t._v("Bạn muốn xoá dữ liệu này?")]),i("v-card-actions",[i("v-spacer"),i("v-btn",{attrs:{color:"blue darken-1",text:""},on:{click:t.closeDelete}},[t._v("Đóng")]),i("v-btn",{attrs:{color:"blue darken-1",text:"",disabled:t.loading},on:{click:t.deleteItemConfirm}},[t._v("Xoá")]),i("v-spacer")],1)],1)],1)],1)]},proxy:!0},{key:"item.users",fn:function(e){var a=e.item;return t._l(t.filterUser(a.users),(function(e){return i("p",{key:e.id},[t._v(t._s(e.name))])}))}},{key:"item.description",fn:function(e){var a=e.item;return[i("p",[t._v(t._s(a.description?a.description:"-"))])]}},{key:"item.actions",fn:function(e){var a=e.item;return[i("v-icon",{attrs:{small:""},on:{click:function(e){return t.deleteItem(a)}}},[t._v(" mdi-delete ")])]}},{key:"no-data",fn:function(){return[i("v-btn",{attrs:{color:"primary"},on:{click:t.initialize}},[t._v(" Reset ")])]},proxy:!0}])})],1):i("h1",[t._v("Không có dữ liệu trực nhật!")])],1)},s=[],n=(i(6699),i(1428)),r=i(9023),l=i(6838),d={name:"UsersPage",data:()=>({valid:!0,snackbar:!1,success:!1,msg:"",tableLoading:!1,workData:[],dialog:!1,dialogDelete:!1,editedItem:{id:"",date:"",users:null,description:"",expires:""},loading:!1,e6:[],notEmptyDate:[t=>!!t||"Trường này không được để trống."],notEmptyUsers:[t=>!!t||"Trường này không được để trống."],notEmptyExpires:[t=>!!t||"Trường này không được để trống."],select:null,menu:!1,menu2:!1,time:null,editedIndex:-1,headers:[{text:"Ngày mở",align:"start",value:"date"},{text:"Học sinh tham gia",align:"start",value:"users"},{text:"Ghi chú",align:"start",value:"description"},{text:"Giờ hết hạn",align:"start",value:"expires"},{text:"Hành động",align:"start",value:"actions"}]}),watch:{dialog(t){t||this.close()},dialogDelete(t){t||this.closeDelete()}},async created(){await this.getData()},methods:{validate(){this.$refs.form.validate()},editItem(t){this.editedIndex=this.workData.indexOf(t),this.editedItem={...t},this.dialog=!0},deleteItem(t){this.editedIndex=this.workData.indexOf(t),this.editedItem={...t},this.dialogDelete=!0},async deleteItemConfirm(){await this.deleteWork()},close(){this.dialog=!1,this.$nextTick((()=>{this.editedItem={...this.defaultItem},this.editedIndex=-1}))},closeDelete(){this.dialogDelete=!1,this.$nextTick((()=>{this.editedItem={...this.defaultItem},this.editedIndex=-1}))},async getData(){try{this.tableLoading=!0;const[t,e]=await Promise.all([(0,r.Y8)(),(0,n.ib)()]);this.userData=t.data,this.workData=e.data.map((t=>{let e=t.date;return e=e.split("T")[0],Object.assign(t,{date:e}),t}))}catch(t){console.log(t)}finally{this.tableLoading=!1}},async createWork(){try{this.loading=!0;const t=(0,l.Cl)(this.editedItem);delete t.id,t.date=new Date(t.date).toISOString(),await(0,n.UU)(t),this.editedItem.users=this.userData.filter((e=>t.users.includes(e.id))),this.workData.push(this.editedItem),this.snackbar=!0,this.success=!0,this.msg="Thêm thành công",this.close()}catch(t){this.snackbar=!0,this.success=!1,this.msg="Cõ lỗi khi tạo dữ liệu, thử lại sau",console.log(t)}finally{this.loading=!1}},async deleteWork(){try{this.loading=!0;const t=(0,l.Cl)(this.editedItem),{id:e}=t;await(0,n.Js)(e),this.workData.splice(this.editedIndex,1),this.snackbar=!0,this.success=!0,this.msg="Xoá thành công",this.closeDelete()}catch(t){this.snackbar=!0,this.success=!1,this.msg="Cõ lỗi khi tạo dữ liệu, thử lại sau",console.log(t)}finally{this.loading=!1}},async save(){this.editedIndex>-1?await this.updateUser():await this.createWork(),this.validate()},filterUser(t){return t.map((t=>({name:t.name,id:t.id})))}}},o=d,c=i(1001),u=(0,c.Z)(o,a,s,!1,null,null,null),m=u.exports},1428:function(t,e,i){i.d(e,{Js:function(){return r},UU:function(){return s},ib:function(){return n}});var a=i(5972);function s(t){return(0,a.Z)({url:"/v1/works",method:"post",data:t})}function n(){return(0,a.Z)({url:"/v1/works",method:"get"})}function r(t){return(0,a.Z)({url:`/v1/works/${t}`,method:"delete"})}}}]);
//# sourceMappingURL=488.6a6877f5.js.map